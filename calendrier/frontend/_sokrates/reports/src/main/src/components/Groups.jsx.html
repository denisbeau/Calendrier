<html>
<head>
    <title>src/components/Groups.jsx</title>
    <style type="text/css" media="screen">
        #editor {
            position: absolute;
            top: 40px;
            right: 0;
            bottom: 0;
            left: 0;
        }
    </style>
</head>
<body style="font-family: 'DejaVu Sans', Arial, Helvetica, sans-serif">
<h3 style="margin-bottom: 0">src/components/Groups.jsx (<b>173</b> lines of code) (<a href="Groups.jsx">raw</a>):</h3>
<div id="editor">// src/components/Groups.jsx
import React, { useEffect, useState } from &quot;react&quot;;
import {
  createGroup,
  fetchUserGroups,
  joinGroupByCode,
} from &quot;../services/groups&quot;;
import { useAuth } from &quot;./AuthContext&quot;;

export default function Groups({ onShowGroupCalendar }) {
  const { user } = useAuth();
  const [groups, setGroups] = useState([]);
  const [name, setName] = useState(&quot;&quot;);
  const [description, setDescription] = useState(&quot;&quot;);
  const [joinCode, setJoinCode] = useState(&quot;&quot;);
  const [createdCode, setCreatedCode] = useState(null);
  const [loading, setLoading] = useState(false);
  const [msg, setMsg] = useState(null);

  useEffect(() =&gt; {
    if (!user) return;
    loadGroups();
  }, [user]);

  async function loadGroups() {
    try {
      const data = await fetchUserGroups();
      setGroups(data || []);
    } catch (err) {
      console.error(&quot;Failed to load groups:&quot;, err);
      setMsg(&quot;Erreur lors du chargement des groupes.&quot;);
    }
  }

  async function handleCreate(e) {
    e.preventDefault();
    setMsg(null);
    setCreatedCode(null);
    if (!name.trim()) return setMsg(&quot;Nom requis&quot;);
    setLoading(true);
    try {
      const group = await createGroup({
        name: name.trim(),
        description: description.trim() || null,
      });
      setName(&quot;&quot;);
      setDescription(&quot;&quot;);
      setMsg(&quot;Groupe cr&eacute;&eacute;.&quot;);
      // show the invite code if server returned it
      if (group?.invite_code) {
        setCreatedCode(group.invite_code);
      } else {
        setCreatedCode(null);
      }
      await loadGroups();
    } catch (err) {
      console.error(err);
      setMsg(err.message || &quot;Erreur lors de la cr&eacute;ation du groupe&quot;);
    } finally {
      setLoading(false);
    }
  }

  async function handleJoin(e) {
    e.preventDefault();
    setMsg(null);
    const code = (joinCode || &quot;&quot;).trim().toUpperCase();
    if (!code || code.length !== 6)
      return setMsg(&quot;Entrez un code &agrave; 6 lettres.&quot;);
    setLoading(true);
    try {
      await joinGroupByCode(code);
      setJoinCode(&quot;&quot;);
      setMsg(&quot;Vous avez rejoint le groupe !&quot;);
      await loadGroups();
    } catch (err) {
      console.error(&quot;joinGroupByCode:&quot;, err);
      setMsg(err.message || &quot;Impossible de rejoindre le groupe.&quot;);
    } finally {
      setLoading(false);
    }
  }

  return (
    &lt;div className=&quot;simple-card max-w-4xl mx-auto p-4 space-y-4&quot;&gt;
      &lt;h2 className=&quot;text-2xl font-semibold&quot;&gt;Mes groupes&lt;/h2&gt;

      {msg &amp;&amp; (
        &lt;div className=&quot;text-sm text-gray-300 p-2 bg-gray-900/20 rounded&quot;&gt;
          {msg}
        &lt;/div&gt;
      )}

      &lt;div className=&quot;grid md:grid-cols-2 gap-4&quot;&gt;
        &lt;div&gt;
          &lt;h3 className=&quot;font-medium&quot;&gt;Cr&eacute;er un groupe&lt;/h3&gt;
          &lt;form onSubmit={handleCreate} className=&quot;space-y-2&quot;&gt;
            &lt;input
              placeholder=&quot;Nom du groupe&quot;
              className=&quot;simple-input&quot;
              value={name}
              onChange={(e) =&gt; setName(e.target.value)}
            /&gt;
            &lt;input
              placeholder=&quot;Description (facultatif)&quot;
              className=&quot;simple-input&quot;
              value={description}
              onChange={(e) =&gt; setDescription(e.target.value)}
            /&gt;
            &lt;button className=&quot;simple-button&quot; disabled={loading}&gt;
              {loading ? &quot;Cr&eacute;ation...&quot; : &quot;Cr&eacute;er&quot;}
            &lt;/button&gt;
          &lt;/form&gt;

          {createdCode &amp;&amp; (
            &lt;div className=&quot;mt-2 text-sm&quot;&gt;
              Code d'invitation g&eacute;n&eacute;r&eacute; :{&quot; &quot;}
              &lt;strong className=&quot;font-mono text-lg&quot;&gt;{createdCode}&lt;/strong&gt;
              &lt;div className=&quot;text-xs text-gray-400 mt-1&quot;&gt;
                Partagez ce code (6 lettres) avec les personnes que vous voulez
                inviter.
              &lt;/div&gt;
            &lt;/div&gt;
          )}
        &lt;/div&gt;

        &lt;div&gt;
          &lt;h3 className=&quot;font-medium&quot;&gt;Rejoindre un groupe (par code)&lt;/h3&gt;

          &lt;form onSubmit={handleJoin} className=&quot;mt-2 flex gap-2 items-center&quot;&gt;
            &lt;input
              placeholder=&quot;Entrez le code (6 lettres)&quot;
              className=&quot;simple-input flex-1&quot;
              value={joinCode}
              onChange={(e) =&gt; setJoinCode(e.target.value)}
              maxLength={6}
            /&gt;
            &lt;button className=&quot;simple-button&quot; disabled={loading}&gt;
              {loading ? &quot;...&quot; : &quot;Rejoindre&quot;}
            &lt;/button&gt;
          &lt;/form&gt;

          &lt;p className=&quot;text-xs text-gray-400 mt-2&quot;&gt;
            Entrez le code &agrave; 6 lettres du groupe. Si le code est valide, vous
            serez ajout&eacute; directement au groupe.
          &lt;/p&gt;
        &lt;/div&gt;
      &lt;/div&gt;

      &lt;div&gt;
        &lt;h3 className=&quot;font-medium&quot;&gt;Groupes dont vous faites partie&lt;/h3&gt;
        &lt;ul className=&quot;space-y-2&quot;&gt;
          {groups.length === 0 &amp;&amp; (
            &lt;li className=&quot;text-sm text-gray-400&quot;&gt;Aucun groupe&lt;/li&gt;
          )}
          {groups.map((g) =&gt; (
            &lt;li
              key={g.group.id}
              className=&quot;p-2 border rounded bg-gray-900/40 flex items-center justify-between&quot;
            &gt;
              &lt;div&gt;
                &lt;div className=&quot;font-semibold&quot;&gt;{g.group.name}&lt;/div&gt;
                &lt;div className=&quot;text-sm text-gray-400&quot;&gt;
                  {g.group.description}
                &lt;/div&gt;
              &lt;/div&gt;

              &lt;div className=&quot;flex gap-2&quot;&gt;
                &lt;button
                  className=&quot;simple-button&quot;
                  onClick={() =&gt;
                    onShowGroupCalendar &amp;&amp; onShowGroupCalendar(g.group.id)
                  }
                &gt;
                  Voir calendrier
                &lt;/button&gt;
                &lt;div className=&quot;text-sm text-gray-300 self-center&quot;&gt;
                  {g.role}
                &lt;/div&gt;
              &lt;/div&gt;
            &lt;/li&gt;
          ))}
        &lt;/ul&gt;
      &lt;/div&gt;
    &lt;/div&gt;
  );
}
</div>
<script src="https://www.zeljkoobrenovic.com/tools/common/lib/ace/ace.js" type="text/javascript" charset="utf-8"></script>
<script>
    var editor = ace.edit("editor");
    editor.session.setMode("ace/mode/html");
    editor.setTheme("ace/theme/xcode");
    editor.setReadOnly(true);
    editor.setOption("wrap", true);
    editor.setPrintMarginColumn(120);
</script>
</body>
