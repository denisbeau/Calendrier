<html>
<head>
    <title>frontend/src/context/AuthContext.jsx</title>
    <style type="text/css" media="screen">
        #editor {
            position: absolute;
            top: 40px;
            right: 0;
            bottom: 0;
            left: 0;
        }
    </style>
</head>
<body style="font-family: 'DejaVu Sans', Arial, Helvetica, sans-serif">
<h3 style="margin-bottom: 0">frontend/src/context/AuthContext.jsx (<b>125</b> lines of code) (<a href="AuthContext.jsx">raw</a>):</h3>
<div id="editor">// src/context/AuthContext.jsx
import React, { createContext, useContext, useEffect, useState } from &quot;react&quot;;
import { supabase } from &quot;../supabaseClient&quot;;

const AuthContext = createContext();

export function AuthProvider({ children }) {
  const [user, setUser] = useState(null);
  const [initializing, setInitializing] = useState(true);
  const [error, setError] = useState(null); // &lt;-- used to show a big red error screen

  useEffect(() =&gt; {
    try {
      // Add timeout to prevent infinite loading
      const timeout = setTimeout(() =&gt; {
        console.warn(&quot;Auth initialization timeout - proceeding without auth&quot;);
        setInitializing(false);
      }, 3000); // 3 second timeout

      const session = supabase.auth.getSession();

      // supabase.getSession returns a promise in v2, handle it:
      session
        .then(({ data, error: sessionError }) =&gt; {
          if (sessionError) {
            console.error(&quot;Auth session error:&quot;, sessionError);
          }
          setUser(data?.session?.user ?? null);
          setInitializing(false);
          clearTimeout(timeout);
        })
        .catch((err) =&gt; {
          console.error(&quot;Auth initialization error:&quot;, err);
          setInitializing(false);
          clearTimeout(timeout);
        });

      // subscribe to auth changes
      const { data: listener } = supabase.auth.onAuthStateChange(
        (_event, session) =&gt; setUser(session?.user ?? null)
      );

      return () =&gt; {
        clearTimeout(timeout);
        // best-effort unsubscribe (safe optional chaining)
        listener?.subscription?.unsubscribe?.();
      };
    } catch (err) {
      // capture the error and show a very visible red error page
      console.error(&quot;AuthContext init error:&quot;, err);
      setError(err.message || String(err));
      setInitializing(false);
    }
  }, []);

  const signOut = async () =&gt; {
    await supabase.auth.signOut();
    setUser(null);
  };

  // If there is an initialization/runtime error, render a very visible red error screen
  if (error) {
    return (
      &lt;div
        role=&quot;alert&quot;
        aria-live=&quot;assertive&quot;
        // Force full-viewport coverage with inline styles so it's reliable even without Tailwind compiled
        style={{
          position: 'fixed',
          top: 0,
          left: 0,
          right: 0,
          bottom: 0,
          width: '100vw',
          height: '100vh',
          zIndex: 2147483647,
          display: 'flex',
          alignItems: 'center',
          justifyContent: 'center',
          padding: 24,
          background: '#660000',
          color: 'white',
        }}
      &gt;
        &lt;div style={{ maxWidth: 960, width: '100%', textAlign: 'center' }}&gt;
          &lt;div
            style={{
              width: 140,
              height: 140,
              borderRadius: 9999,
              margin: '0 auto',
              background: 'rgba(0,0,0,0.3)',
              display: 'flex',
              alignItems: 'center',
              justifyContent: 'center',
              fontSize: 84,
              fontWeight: 900,
              color: '#ffdddd',
              boxShadow: '0 8px 24px rgba(0,0,0,0.6)'
            }}
            aria-hidden
          &gt;
            âœ•
          &lt;/div&gt;

          &lt;h1 style={{ marginTop: 24, fontSize: 28, fontWeight: 800 }}&gt;Authentication initialization failed&lt;/h1&gt;
          &lt;p style={{ marginTop: 8, fontSize: 14, opacity: 0.95 }}&gt;A critical error occurred while initializing authentication.&lt;/p&gt;

          &lt;div style={{ marginTop: 20, padding: 16, background: 'rgba(255,255,255,0.03)', borderRadius: 8 }}&gt;
            &lt;strong style={{ display: 'block', textAlign: 'left', marginBottom: 8 }}&gt;Error message (visible to help debugging):&lt;/strong&gt;
            &lt;pre
              style={{
                whiteSpace: 'pre-wrap',
                textAlign: 'left',
                background: 'rgba(0,0,0,0.25)',
                padding: '12px',
                borderRadius: 6,
                fontSize: 13,
                overflowX: 'auto'
              }}
            &gt;
              {error}
            &lt;/pre&gt;
          &lt;/div&gt;

          &lt;p style={{ marginTop: 12, fontSize: 12, opacity: 0.85 }}&gt;Hint: check for typos in &lt;code&gt;src/context/AuthContext.jsx&lt;/code&gt; &mdash; a common mistake is a misspelled &lt;code&gt;getSession&lt;/code&gt; or &lt;code&gt;setInitializing&lt;/code&gt;.&lt;/p&gt;
        &lt;/div&gt;
      &lt;/div&gt;
    );
  }

  return (
    &lt;AuthContext.Provider value={{ user, initializing, signOut }}&gt;
      {children}
    &lt;/AuthContext.Provider&gt;
  );
}

export const useAuth = () =&gt; useContext(AuthContext);

</div>
<script src="https://www.zeljkoobrenovic.com/tools/common/lib/ace/ace.js" type="text/javascript" charset="utf-8"></script>
<script>
    var editor = ace.edit("editor");
    editor.session.setMode("ace/mode/html");
    editor.setTheme("ace/theme/xcode");
    editor.setReadOnly(true);
    editor.setOption("wrap", true);
    editor.setPrintMarginColumn(120);
</script>
</body>
